<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="njas.css">
</head>
<body>
    <main>
        <template id="errorDialogTemp">
            <div id="errorDialog" class="errorDialog">
                <h2>Coś nie poszło</h2>
                <span id="errContent"></span>
                <div class="b">
                    <button id="errDClose">Zamknij komunikat</button>
                </div>
            </div>
        </template>
        <div class="menuBar">
            <div class="whiteSquareRounded">
                <div style="width:26px;height:5px;background-color:var(--primary-colour);margin:1px;"></div>
                <div style="width:26px;height:5px;background-color:var(--primary-colour);margin:1px;"></div>
                <div style="width:26px;height:5px;background-color:var(--primary-colour);margin:1px;"></div>
            </div>
            <div class="Logo">Document <span>Office</span></div>
            <div style="width:2px;height:40px;background-color:rgba(250, 250, 250, .9);margin-top:6px;"></div>
        </div>
        <div class="work_nav"></div>
        <div id="dragAndDrop" class="dragAndDrop">
            <p style="pointer-events: none;">Przeciągnij i upuść tutaj plik Worda, aby rozpocząć.</p>
        </div>
    </main>

    <template id="editorTemp">
        
    </template>

    <template id="dialogBodyControl">
        <div class="bv">
            <span>Nazwa Pliku</span>
            <input type="text" id="nameFile" class="filePath">
        </div>
        <div class="bc">
            <span>Ilość Plików</span>
            <div class="countC">
                <pre contenteditable="true">0</pre><p>/500</p>
            </div>
        </div>
        <button id="nextButtonn" class="nextButton">Dalej</button>
    </template>

    <template id="dialogStartTemplate">
        <div id="dialogStart" class="dialogStart">
            <div class="dialogHeader">
                <div class="closeDlg" id="bClose"><img src="./img/close.svg" alt="close"></div>
            </div>
            <div class="dialogSelectHeader">
                <div class="dialogSelectHeaderItem" id="settings">Ustawienia</div>
                <div class="dialogSelectHeaderItem" id="countFile">Ile plików</div>
            </div>
            <div class="dialogBody" id="dBody">

            </div>
        </div>
    </template>
    <script src="nic2.js"></script>
    <script>
        let ff = null;

        function runningSuperEditor(files, htmElement){
            let editorTempp = document.querySelector('#dialogStartTemplate').content.cloneNode(true);
            let dbControl = document.querySelector('#dialogBodyControl').content.cloneNode(true);
            try{
                if(files.length == 1){
                    if(mFile.fileSystem.existsSync(`docxs/${files[0].name}`)){
                        editorTempp.querySelector('#bClose').addEventListener('click', (e)=>{
                            e.path[3].remove();
                            // console.log(e);
                        })
                        editorTempp.querySelector('#countFile').setAttribute("activee", "");
                        editorTempp.querySelector('#dBody').append(dbControl);
                        editorTempp.querySelector('#dBody').querySelector('#nextButtonn').addEventListener('click', ()=>{
                            mFile.fileSystem.readFile(`docxs/${files[0].name}/word/document.xml`, 'utf8', (err, buff) => {
                                if (err) {
                                    return console.log(err);
                                }
                                ff = start(files[0], buff);
                                document.querySelector('#dialogStart').remove();
                                document.querySelector('#dragAndDrop').remove();
                            });
                        })
                        editorTempp.querySelector('#nameFile').value = `${files[0].name}`;
                        document.querySelector('main').append(editorTempp);
                    }else{
                        // decompress(`${file[0].path}`, `docxs/${file[0].name}`).then(fl => {
                        //     fl.forEach(l => {
                        //         if (l.path == "word/document.xml") {
                        //             file_system.readFile(`docxs/${l.name}/${l.path}`, paraf);
                        //         }
                        //     })
                        // })
                    }
                }else{
                    // files.forEach(f =>{
                    //     if(existsFileOrPath(`docxs/${f.path}`)){
                    //         htmElement.appendChild(editorTemp);
                    //         start(`docxs/${f.path}`, htmElement.querySelector("#z"));
                    //     }else{
                    //         decompress(`${f.path}`, `docxs/${f.name}`).then(fl => {
                    //             fl.forEach(l => {
                    //                 if (l.path == "word/document.xml") {
                    //                     file_system.readFile(`docxs/${l.name}/${l.path}`, paraf);
                    //                     start(`docxs/${l.name}/${l.path}`, htmElement.querySelector("#z"));
                    //                 }
                    //             })
                    //         })
                    //     }
                    // })
                }
            }catch(r){
                // let errorDialogTemp = document.querySelector('#errorDialogTemp').content.cloneNode(true);
                // errorDialogTemp.querySelector('#errContent').textContent = r;
                // errorDialogTemp.querySelector('#errDClose').addEventListener('click', e=>{e.target.offsetParent.remove()});
                // document.body.querySelector('main').append(errorDialogTemp);
                console.log(r)
            }
            
        }

        document.querySelector('#dragAndDrop').addEventListener("dragenter", (e)=>{
            e.preventDefault();
            e.stopPropagation();
            e.target.style.backgroundColor = "rgba(205, 205, 205, 1)";
        });
        document.querySelector('#dragAndDrop').addEventListener("dragleave", (e)=>{
            e.preventDefault();
            e.stopPropagation();
            e.target.style.backgroundColor = "rgba(255, 255, 255, 1)";
        });
        document.querySelector('#dragAndDrop').addEventListener("dragover", (e)=>{
            e.preventDefault();
            e.stopPropagation();
        });
        document.querySelector('#dragAndDrop').addEventListener("drop",(e)=>{
            e.preventDefault();
            e.stopPropagation();
            e.target.style.backgroundColor = "rgba(255, 255, 255, 1)";
            if(e.dataTransfer.files.length > 0){
                let files = e.dataTransfer.files;
                runningSuperEditor(files, document.querySelector("main"));
            }
        });
    </script>
</body>
</html>