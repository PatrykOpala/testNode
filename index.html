<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root{
            --rgb-white: rgba(207, 202, 202);
            --primary-colour: rgb(30, 30, 180);
            --primary-colour-light: rgb(49, 49, 247);
            --blue-colour: rgb(39, 39, 236);
            --border-colour:rgba(250, 250, 250, .9);
            --border-colour-black: rgba(10, 10, 10, 0.3);
            --white: #fff;
            --onePx-solid--black-border: 1px solid var(--border-colour-black);
            --twoPX-solid-black-border: 2px solid var(--border-colour-black);
            --twoPX-solid-border: 2px solid;
        }
        *{ font-family: Alef;}
        body{margin:0; padding:0;}
        main, .countFileContainer, .buttonsContainer, .menuBar, .work_nav, .dialogStart, .closeDlg, .dialogSelectHeader, .dialogBody, .countC, .boldBTN, .EditorContainer,
        .Editor, .EditorParagraph ,.ApplyChangeText, .LogoContainer{display: flex;}

        main, .dialogStart, .dialogBody, .boldBTN, .EditorContainer, .ApplyChangeText, .Editor{flex-direction: column;}

        .LogoContainer{width: 20vw;}

        .whiteSquareRounded{
            width: 45px;
            height: 45px;
            background-color: var(--primary-colour);
            margin-right: 10px;
            margin-top: 2px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .Logo{
            font-size: 1.7rem;
            font-family: sans-serif;
            margin-top: 10px;
            color:var(--primary-colour);
        }

        .Logo > span{
            font-weight: 600;
            letter-spacing: 3px;
        }

        main{
            width: 100%;
            height: 100vh;
        }
        .paragraphContainer{
            width: 582px;
            height: 300px;
            margin: 0 5px;
            overflow: hidden;
            overflow-y: scroll;
            position: relative;
        }
        pre{outline: none;}
        pre:hover{ background-color: var(--rgb-white);}
        .countFileContainer{
            margin: 20px 0;
        }
        .buttonsContainer{
            width:100%;
            justify-content:flex-end;
            margin:10px 0;
        }
        .countFileContainerElementsLabel{
            margin: 9px 10px;
            font-size:20px;
            text-align:center;
        }
        .countFileContainerElementsInput{
            width:100px;
            height:40px;
            border:var(--onePx-solid--black-border);
            outline:none;
            text-align:center;
            font-size:29px;
            margin-left:6px;
        }
        .menuBar{
            height: 49px;
            padding: 10px;
            background-color: var(--border-colour);
            border-bottom:var(--onePx-solid-border, 1 solid) var(--primary-colour);
            display: flex;
            justify-content: space-between;
        }
        .work_nav{
            width:100%;
            height:38px;
            background-color: var(--border-colour);
        }
        .dialogStart{
            background-color: var(--white);
            border-radius: 4px;
            border: var(--onePx-solid--black-border);
            padding: 10px;
            position: absolute;
            top: 20vh;
            left: 20vw;
            height: 67vh;
        }
        .dialogHeader{
            width: 48vw;
            height: 27px;
        }
        .closeDlg{
            width: 20px;
            height: 20px;
            margin-left: 96%;
            justify-content: center;
            align-items: center;
            padding: 3px;
            border-radius: 4px;
        }
        .closeDlg:hover{ background-color: var(--border-colour-black);}
        .dialogSelectHeader{
            width: 500px;
            height: 35px;
        }
        [activee]{color: var(--primary-colour);font-weight: 600;}
        .dialogSelectHeaderItem{
            font-size: 16px;
            text-align: center;
            line-height: 35px;
            margin-left: 10px;
            padding: 0 4px;
            border-bottom: 2px solid transparent;
            border-top: none;
            border-left: none;
            border-right: none;
            background-color: transparent;
        }
        .dialogSelectHeaderItem:hover{
            cursor: pointer;
            color: var(--primary-colour);
            border-bottom: var(--twoPX-solid-border) var(--primary-colour);
        }
        .dialogBody{
            width: 100%;
            align-items: center;
        }
        .dialogEdytorBody{
            display: inline-grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
        }
        input, .nextButton{border:none; outline:none;}
        .bv{
            width: 160px;
            height: 50px;
            position: relative;
            margin: 4vh 0;
        }
        .bv > span, .bc > span{
            position: absolute;
            top: -10px;
            left: 10px;
            z-index: 70;
            background-color: var(--white);
            font-size: 0.9em;
        }
        .filePath{
            width:150px;
            height:40px;
            border-radius: 4px;
            border:var(--twoPX-solid-black-border);
            font-size: 1em;
        }
        .bc{
            width: 140px;
            height: 50px;
            position: relative;
            margin-top: 10px;
        }
        .countC{
            width:100%;
            height:40px;
            border-radius: 4px;
            border: var(--twoPX-solid-black-border);
            font-size: 1em;
            text-align: center;
            justify-content: center;
            align-items: center;
        }
        .countC > pre{font-size: 1.5em;}
        .countC > p{
            cursor: default;
            font-size: 1.5em;
        }
        .nextButton{
            width:90px;
            height:35px;
            background-color: var(--primary-colour);
            margin-top: 30px;
            color: var(--white);
            border-radius: 4px;
            font-size: 1.1em;
        }
        .Font, .boldBTN{ margin: 4px 4px;}
        .Font{
            width: 100px;
            height: 29px;
            text-align: center;
            line-height: 30px;
        }
        .boldBTN{
            width: 29px;
            height: 29px;
            background-color: transparent;
            border: none;
            border-bottom: 2px solid transparent;
        }
        .boldBTN:hover{background-color: transparent;border-bottom: var(--twoPX-solid-border) var(--primary-colour);}

        .boldBTN, .EditorContainer, .ApplyChangeText{justify-content: center;align-items: center;}

        .EditorContainer{
            width: 100%;
            height: 100%;
            margin: 4px 0;
            position: relative;
            overflow-y: scroll;
        }
        .Editor{
            position: absolute;
            width: 11in;
            min-height: 90%;
        }
        .EditorParagraph{min-height: 30px;}
        .dBodyLeft, .dBodyRight{width: 24vw;height: 63vh;}
        .PreviewTextContainer{
            width: 22vw;
            height: 40vh;
            padding: 10px;
            overflow-y: scroll;
            margin-bottom: 20px;
        }
        .PreviewTextContainer::-webkit-scrollbar{
            width: 5px;
            height: 5px;
            background-color: transparent;
        }
        .PreviewTextContainer::-webkit-scrollbar-thumb{
            background-color: var(--primary-colour);
        }
        .PreviewTextContainer::-webkit-scrollbar-thumb:hover{
            background-color: var(--primary-colour-light);
        }
        .ApplyChangeText{
            width: 20vw;
            border: var(--onePx-solid-border, 1 solid) rgb(72, 89, 21);
        }
        .ApplyChangeText{
            height: 5vh;
            padding: 6px;
            border: var(--onePx-solid--black-border);
            margin-left: 10px;
            font-size: 1.5rem;
        }
        .OtherFilesContainer{
            width: 290px;
            height: 70%;
            margin: 10% 10%;
            overflow-y: scroll;
        }
        .OtherFilesItem{
            width: 100%;
            height: 47px;
            margin-top: 10px;
            font-family: sans-serif;
            text-align: center;
            line-height: 50px;
        }
        .OtherFilesItem:hover{
            cursor: pointer;
            background-color: var(--primary-colour);
            color: var(--white);
        }
        [do-select]{ background-color: var(--primary-colour); color: var(--white);}
        .continueButton{
            margin: 20px 65%;
            color:var(--primary-colour);
            background-color: transparent;
            font-weight: bold;
            outline-width: thin;
            outline-color: var(--white);
            border: none;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <main>
        <div class="menuBar" id="mBar">
            <div class="LogoContainer">
                <img src="img/logo30x30.svg" alt="">
                <div class="Logo">Document <span>Office</span></div>
            </div>
        </div>
        <drag-and-drop></drag-and-drop>

        <template></template>

    </main>
    <script src="Screen/DOComponents.js" async></script>
    <script>
        let pars = new DOMParser();
        let dragg = document.querySelector('drag-and-drop');
        let vbcx = document.querySelector('main');
        let inst = null;
        let bjs = "";
        const changeFiles = [];

        let Documentt = {
            fileName: "",
            body: []
        }

        function createWorkNavBar(root){
            const workNav = document.createElement('work-nav');
            const fontContainer = document.createElement('div');
            fontContainer.classList.add('Font');
            fontContainer.textContent = "Czcionka";
            const fontSizeButtons = document.createElement('font-size-buttons');

            const buttonBold = document.createElement('button');
            buttonBold.classList.add('boldBTN');
            const btnImg = document.createElement('img');
            btnImg.setAttribute("src", "./img/bold32x32.svg");
            btnImg.setAttribute("alt", "bold");
            buttonBold.append(btnImg)

            const buttonItalic = document.createElement('button');
            buttonItalic.classList.add('boldBTN');
            const btnImgItalic = document.createElement('img');
            btnImgItalic.setAttribute("src", "./img/italic.svg");
            btnImgItalic.setAttribute("alt", "bold");
            buttonItalic.append(btnImgItalic)

            const buttonUnderline = document.createElement('button');
            buttonUnderline.classList.add('boldBTN');
            const btnImgUnderline = document.createElement('img');
            btnImgItalic.setAttribute("src", "./img/underline.svg");
            btnImgItalic.setAttribute("alt", "bold");
            buttonUnderline.append(btnImgUnderline)

            workNav.append(fontContainer, fontSizeButtons, buttonBold, buttonItalic, buttonUnderline);
            root.append(workNav);
        }

        function PAndR(mlElement, rt, fName){
            let edytorParagraph = document.createElement('div');
                edytorParagraph.classList.add('EditorParagraph');

            for(let rb of mlElement.r){
                let pRun = document.createElement('pre');
                pRun.contentEditable = true;
                pRun.style.display = 'inline-block';
                pRun.style.margin = "0 0";
                if(rb?.rPr?.sz !== undefined){
                    pRun.style.fontSize = `${rb?.rPr?.sz}pt`;
                    pRun.setAttribute("do-font-size", `${rb?.rPr?.sz}`);
                }
                if(rb?.rPr?.bold?.val){
                    pRun.style.fontWeight = 'bold';
                    pRun.setAttribute("do-font-weight", "bold");
                }
                if(rb?.rPr?.italic?.val){
                    pRun.style.fontStyle = 'italic';
                    pRun.setAttribute("do-font-style", "italic");
                }
                if(rb?.rPr?.underline?.val){
                    pRun.style.textDecoration = 'underline';
                    pRun.setAttribute("do-text-decoration", "underline");
                }
                if(rb?.rPr?.strike?.val){
                    pRun.style.textDecoration = "underline line-through";
                    pRun.setAttribute("do-text-decoration", "underline line-through");
                }
                pRun.setAttribute('oldValue', rb?.t?.text);
                pRun.textContent = rb?.t?.text;
                if (rb?.rPr?.color?.val){
                    pRun.style.color = `${rb?.rPr?.color?.val}`;
                    pRun.setAttribute("do-color", `${rb?.rPr?.color?.val}`);
                }
                edytorParagraph.append(pRun);
            }
            edytorParagraph.addEventListener("click", (event)=>{
                if(event.target.localName === "pre"){
                    if(event.target.parentNode.hasAttribute("do-editing")){event.target.parentNode.removeAttribute("do-editing");}else{event.target.parentNode.setAttribute("do-editing", "");}
                    EdytorDialog(vbcx, event.target, Documentt.fileName);
                }
            });
            rt.append(edytorParagraph);
        }

        function T(tElement, rt2){
            // 6,944444444444444e-4
            let tablee = {
                type: 'Table',
                tblPr: {
                    tblW: {
                        width: tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:w'),
                        type: ""
                    },
                    jc: tElement?.querySelector('tblPr').querySelector('jc').getAttribute('w:val'),
                    tblInd: {
                        width: tElement?.querySelector('tblPr').querySelector('tblInd').getAttribute('w:w'),
                        type: tElement?.querySelector('tblPr').querySelector('tblInd').getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                    },
                    tblLayout: {
                        type: tElement?.querySelector('tblPr').querySelector('tblLayout').getAttribute('w:type') || "null"
                    },
                    tblCellMar: {
                        top: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('top')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('top')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        },
                        left: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('left')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('left')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        },
                        bottom: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('bottom')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('bottom')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        },
                        right: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('right')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('right')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        }
                    }
                },
                tblGrid: {
                    gridCols: []
                },
                tbr: [],
            }

            if(tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type') === 'dxa'){
                tablee.tblPr.tblW.type = tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type')
            }else if(tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type') === 'pct'){
                tablee.tblPr.tblW.type = tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type')
            }else{
                tablee.tblPr.tblW.type = ""
            }
            
            let table = document.createElement('table');
            table.style.border = "1px solid red";

            let tblGridColumns =  tElement?.querySelector('tblGrid').childNodes;
            for(let tblGC = 0; tblGC < tblGridColumns.length; tblGC++){
                let gridCol = {
                    width: Number.parseInt(tblGridColumns[tblGC].getAttribute('w:w'))
                };
                tablee.tblGrid.gridCols.push(gridCol);
            }

            let tRows = tElement?.querySelectorAll('tr');
            for(let tR = 0; tR < tRows.length; tR++){
                let tableRow = {
                    trPr: tRows[tR]?.querySelector('trPr') || null,
                    tcols: [],
                }

                if(tRows[tR].querySelector('tc') !== null){
                    let tc = {
                        tcPr: {
                            tcW: {
                                width: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcW')?.getAttribute('w:w')),
                                type: tRows[tR]?.querySelector('tcPr')?.querySelector('tcW')?.getAttribute('w:type')
                            },
                            tcBorders: {
                                top: {
                                    val: tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:val'),
                                    sz: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:sz')),
                                    space: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:space')),
                                    color: tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:color')
                                },
                                left: {
                                    val: tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:val'),
                                    sz: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:sz')),
                                    space: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:space')),
                                    color: tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:color')
                                },
                                bottom: {
                                    val: tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:val'),
                                    sz: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:sz')),
                                    space: Number.parseInt(tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:space')),
                                    color: tRows[tR]?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:color')
                                },
                            }
                        },
                        p: []
                    }

                    let tColumns = tRows[tR].querySelectorAll('tc');
                    for(let tcc = 0; tc < tColumns.length; tc++){
                        let tcp = tColumns[tcc].querySelectorAll('p');
                        for(let tccp = 0; tccp < tcp.length; tccp++){
                            
                            let TableColumnParagraph = {
                                type: "Paragraph",
                                pPr: {
                                    pStyle: tcp[tccp].querySelector('pPr').querySelector('pStyle')?.getAttribute("w:val"),
                                    rPr: {
                                        sz: Number.parseInt(tcp[tccp].querySelector('pPr')?.querySelector('rPr')?.querySelector('sz')?.getAttribute("w:val")) || null,
                                        szCs: Number.parseInt(tcp[tccp].querySelector('pPr')?.querySelector('rPr')?.querySelector('szCs')?.getAttribute("w:val")) || null
                                    }
                                },
                                runs: []
                            }
                            console.log(tcp[tccp].querySelectorAll('r'))
                            let tcpr = tcp[tccp].querySelectorAll('r');
                            for(let tcprr = 0; tcprr < tcpr.length; tcprr++){
                                const runn = {
                                    type: "Run",
                                    rPr: {
                                        fontSize: Number.parseInt(tcpr[tcprr]?.querySelector("rPr")?.querySelector("sz")?.getAttribute("w:val")) || Number.parseInt(tcpr[tcprr]?.querySelector("rPr")?.querySelector("szCs")?.getAttribute("w:val")),
                                        bold: tcpr[tcprr]?.querySelector("rPr")?.querySelector("b") || r?.querySelector("rPr")?.querySelector("bCs") ? true : false,
                                        italic: tcpr[tcprr]?.querySelector("rPr")?.querySelector("i") || r?.querySelector("rPr")?.querySelector("iCs") ? true : false,
                                        strike: tcpr[tcprr]?.querySelector("rPr")?.querySelector("strike") || r?.querySelector("rPr")?.querySelector("dstrike") ? true : false,
                                        underline: tcpr[tcprr]?.querySelector("rPr")?.querySelector("u") ? true : false,
                                        color: ""
                                    },
                                    oldValues: [] | ''
                                }

                                if (tcpr[tcprr]?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val").startsWith("#")) {
                                    runn.rPr.color = tcpr[tcprr]?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val");
                                } else if (tcpr[tcprr]?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val") === undefined || tcpr[tcprr]?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val") === null) {
                                    runn.rPr.color = "null";
                                } else {
                                    runn.rPr.color = `#${tcpr[tcprr]?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val")}`;
                                }
                                console.log(tcpr[tcprr]?.querySelectorAll("t"));
                                if (tcpr[tcprr]?.querySelectorAll("t").length > 1) {
                                    
                                    // for(let tp = 0; tp < tcpr[tcprr]?.querySelectorAll("t").length; tp++){
                                    //     runn.oldValues.push(tcpr[tcprr]?.querySelectorAll("t")[tp].textContent);
                                    // }
                                } else {
                                    console.log(tcpr[tcprr]?.querySelector("t"));
                                    // runn.oldValues = tcpr[tcprr]?.querySelector('t').textContent;
                                }

                                TableColumnParagraph.runs.push(runn);
                            }
                            tc.p.push(TableColumnParagraph);
                        }
                    }
                    tableRow.tcols.push(tc);
                }
                tablee.tbr.push(tableRow);
            }        
            return tablee
        }

        function createTable(pCC, r) {
            let table = document.createElement("table");
            let tableBody = document.createElement("tbody");

            for(tr of r.tbr){
                let tableRow = document.createElement("tr");
                for(tc of tr.tcols){
                    let tabD = document.createElement("td");
                    tabD.style.border = "1px solid #222222";
                    tabD.style.minHeight = "20px";
                    for(p of tc.p){
                        let paragraph = document.createElement("div");
                        paragraph.style.display = "flex";
                        paragraph.style.flexDirection = "row";
                        paragraph.style.minHeight = "10px";
                        for(pr of p.runs){
                            const run = document.createElement("pre");
                            run.contentEditable = true;
                            run.style.display = "inline";
                            if (pr.rPr.fontFamily) {
                                run.style.fontFamily = pr.rPr.fontFamily;
                            }
                            if(pr.rPr.color !== "null"){
                                run.style.color = pr.rPr.color;
                            }
                            if (pr.rPr.bold) {
                                run.style.fontWeight = "600";
                            }
                            if (pr.rPr.italic) {
                                run.style.fontStyle = "italic";
                            }
                            if (pr.rPr.strike && pr.rPr.underline) {
                                run.style.textDecoration = "underline line-through";

                            }else if (pr.rPr.underline) {
                                run.style.textDecoration = "underline";
                            } else if (pr.rPr.strike) {
                                run.style.textDecoration = "line-through";
                            }
                            if (pr.rPr.fontSize == 22) {
                                run.style.fontSize = "14px";
                            } else if (pr.rPr.fontSize == 48) {
                                run.style.fontSize = "33px";
                            }
                            run.setAttribute("oldValue", pr.oldValues);
                            run.textContent = pr.oldValues;
                            run.addEventListener("click", (e) => {
                                e.target.classList.toggle("kpaction");
                            })
                            run.addEventListener("focusout", (e) => {
                                if (e.target.classList.value == "kpaction") {
                                    e.target.classList.toggle("kpaction")
                                }
                            })
                            run.addEventListener("input", (e) => {
                                e.target.style.border = "1px solid #333333";
                            })
                            paragraph.appendChild(run);
                            paragraph.addEventListener("click", (event)=>{
                                if(event.target.localName === "pre"){
                                    EdytorDialog(vbcx, event.target, Documentt.fileName);
                                }
                            });
                        }
                        tabD.appendChild(paragraph);
                    }
                    tableRow.appendChild(tabD);
                }
                tableBody.appendChild(tableRow);
            }
            table.appendChild(tableBody);
            pCC.appendChild(table);
        }

        function createTableObject(tElement){
            let tablee = {
                type: 'Table',
                tblPr: {
                    tblW: {
                        width: tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:w'),
                        type: ""
                    },
                    jc: tElement?.querySelector('tblPr').querySelector('jc').getAttribute('w:val'),
                    tblInd: {
                        width: tElement?.querySelector('tblPr').querySelector('tblInd').getAttribute('w:w'),
                        type: tElement?.querySelector('tblPr').querySelector('tblInd').getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                    },
                    tblLayout: {
                        type: tElement?.querySelector('tblPr').querySelector('tblLayout').getAttribute('w:type') || "null"
                    },
                    tblCellMar: {
                        top: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('top')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('top')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        },
                        left: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('left')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('left')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        },
                        bottom: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('bottom')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('bottom')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        },
                        right: {
                            width: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('right')?.getAttribute('w:w'),
                            type: tElement?.querySelector('tblPr')?.querySelector('tbCellMar')?.querySelector('right')?.getAttribute('w:type') === 'dxa' ? "DXA" : "null"
                        }
                    }
                },
                tblGrid: {
                    gridCols: []
                },
                tbr: [],
            }

            if(tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type') === 'dxa'){
                tablee.tblPr.tblW.type = tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type')
            }else if(tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type') === 'pct'){
                tablee.tblPr.tblW.type = tElement?.querySelector('tblPr').querySelector('tblW').getAttribute('w:type')
            }else{
                tablee.tblPr.tblW.type = ""
            }
        
            for(const tblGC of tElement?.querySelector('tblGrid').childNodes){
                let gridCol = {width: Number.parseInt(tblGC.getAttribute('w:w'))};
                tablee.tblGrid.gridCols.push(gridCol);
            }
            for(const tRows of tElement?.querySelectorAll('tr')){
                let tableRow = {
                    trPr: tRows?.querySelector('trPr') || null,
                    tcols: [],
                }
                if(tRows.querySelectorAll('tc')){
                    for(const tcc of tRows.querySelectorAll('tc')){
                        let tc = {
                            tcPr: {
                                tcW: {
                                    width: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcW')?.getAttribute('w:w')),
                                    type: tRows?.querySelector('tcPr')?.querySelector('tcW')?.getAttribute('w:type')
                                },
                                tcBorders: {
                                    top: {
                                        val: tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:val'),
                                        sz: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:sz')),
                                        space: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:space')),
                                        color: tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('top')?.getAttribute('w:color')
                                    },
                                    left: {
                                        val: tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:val'),
                                        sz: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:sz')),
                                        space: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:space')),
                                        color: tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('left')?.getAttribute('w:color')
                                    },
                                    bottom: {
                                        val: tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:val'),
                                        sz: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:sz')),
                                        space: Number.parseInt(tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:space')),
                                        color: tRows?.querySelector('tcPr')?.querySelector('tcBorders')?.querySelector('bottom')?.getAttribute('w:color')
                                    },
                                }
                            },
                            p: []
                        }
                        for(const tccp of tcc.querySelectorAll('p')){
                            let TableColumnParagraph = {
                                type: "Paragraph",
                                pPr: {
                                    pStyle: tccp.querySelector('pPr').querySelector('pStyle')?.getAttribute("w:val"),
                                    rPr: {
                                        sz: Number.parseInt(tccp.querySelector('pPr')?.querySelector('rPr')?.querySelector('sz')?.getAttribute("w:val")) || null,
                                        szCs: Number.parseInt(tccp.querySelector('pPr')?.querySelector('rPr')?.querySelector('szCs')?.getAttribute("w:val")) || null
                                    }
                                },
                                runs: []
                            }
                            for(let tcprr of tccp.querySelectorAll('r')){
                                const runn = {
                                    type: "Run",
                                    rPr: {
                                        fontSize: Number.parseInt(tcprr?.querySelector("rPr")?.querySelector("sz")?.getAttribute("w:val")) || Number.parseInt(tcprr?.querySelector("rPr")?.querySelector("szCs")?.getAttribute("w:val")),
                                        fontFamily: tcprr?.querySelector("rPr")?.querySelector("rFonts")?.getAttribute("w:ascii") || tcprr?.querySelector("rPr")?.querySelector("rFonts")?.getAttribute("w:hAnsi") || null,
                                        bold: tcprr?.querySelector("rPr")?.querySelector("b") || tcprr?.querySelector("rPr")?.querySelector("bCs") ? true : false,
                                        italic: tcprr?.querySelector("rPr")?.querySelector("i") || tcprr?.querySelector("rPr")?.querySelector("iCs") ? true : false,
                                        strike: tcprr?.querySelector("rPr")?.querySelector("strike") || tcprr?.querySelector("rPr")?.querySelector("dstrike") ? true : false,
                                        underline: tcprr?.querySelector("rPr")?.querySelector("u") ? true : false,
                                        color: ""
                                    },
                                    oldValues: [] | ''
                                }
                                
                                if (tcprr?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val").startsWith("#")) {
                                    runn.rPr.color = tcprr?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val");
                                } else if (tcprr?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val") === undefined || tcprr?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val") === null) {
                                    runn.rPr.color = "null";
                                } else {
                                    runn.rPr.color = `#${tcprr?.querySelector("rPr")?.querySelector("color")?.getAttribute("w:val")}`;
                                }
                                if (tcprr?.querySelectorAll("t").length > 1) {
                                    for(const tp of tcprr?.querySelectorAll("t")){
                                        runn.oldValues.push(tp.textContent);
                                    }
                                } else {
                                    runn.oldValues = tcprr?.querySelector("t").textContent;
                                }
                                TableColumnParagraph.runs.push(runn);
                            }
                            tc.p.push(TableColumnParagraph);
                        }
                        tableRow.tcols.push(tc);
                    }
                }
                tablee.tbr.push(tableRow);
            }
            return tablee
        }

        function createParagraphObject(mlElement){
            let paragraph = {
                type: "Paragraph",
                pPr: {
                    pStyle: {val: mlElement.querySelector('pPr').querySelector('pStyle').getAttribute('w:val')} || null,
                    bidi:  { val: mlElement.querySelector('pPr').querySelector('bidi').getAttribute('w:val') } || null,
                    jc: { val: mlElement.querySelector('pPr').querySelector('jc').getAttribute('w:val')} || null,
                    rPr: {
                        color:{val: mlElement?.querySelector('pPr')?.querySelector('rPr')?.querySelector('color')?.getAttribute('w:val').startsWith("#") ? mlElement?.querySelector('pPr')?.querySelector('rPr')?.querySelector('color')?.getAttribute('w:val') : `#${mlElement?.querySelector('pPr')?.querySelector('rPr')?.querySelector('color')?.getAttribute('w:val')}`} || null,
                        sz:{val: mlElement?.querySelector('pPr')?.querySelector('rPr')?.querySelector('sz')?.getAttribute('w:val')} || null,
                        szCs:{val: mlElement?.querySelector('pPr')?.querySelector('rPr')?.querySelector('szCs')?.getAttribute('w:val')} || null,
                        fontFamily: {val: mlElement?.querySelector('pPr')?.querySelector("rPr")?.querySelector("rFonts")?.getAttribute("w:ascii") || mlElement?.querySelector("rPr")?.querySelector("rFonts")?.getAttribute("w:hAnsi")} || null,
                        bold: { val: mlElement?.querySelector('pPr')?.querySelector("rPr")?.querySelector("b") ||  mlElement?.querySelector("rPr")?.querySelector("bCs") ? true : false},
                        italic: { val: mlElement?.querySelector('pPr')?.querySelector("rPr")?.querySelector("i") ||  mlElement?.querySelector("rPr")?.querySelector("iCs") ? true : false},
                        strike: { val: mlElement?.querySelector('pPr')?.querySelector("rPr")?.querySelector("strike") ||  mlElement?.querySelector("rPr")?.querySelector("dstrike") ? true : false},
                        underline: { val: mlElement?.querySelector('pPr')?.querySelector("rPr")?.querySelector("u") ? true : false},
                    }
                },
                r: []
            }
            for(const rb of mlElement.querySelectorAll('r')){
                let r = {
                    type: "Run",
                    rPr: {
                        color: {val: rb.querySelector('rPr')?.querySelector('color')?.getAttribute('w:val').startsWith("#") ? rb.querySelector('rPr')?.querySelector('color')?.getAttribute('w:val') : `#${rb.querySelector('rPr')?.querySelector('color')?.getAttribute('w:val')}`} || null,
                        sz: mlElement.querySelector('rPr')?.querySelector('sz')?.getAttribute('w:val') || null,
                        szCs: mlElement.querySelector('rPr')?.querySelector('szCs')?.getAttribute('w:val') || null,
                        fontFamily: {val: mlElement?.querySelector("rPr")?.querySelector("rFonts")?.getAttribute("w:ascii") || mlElement?.querySelector("rPr")?.querySelector("rFonts")?.getAttribute("w:hAnsi")} || null,
                        bold: { val: mlElement?.querySelector("rPr")?.querySelector("b") ||  mlElement?.querySelector("rPr")?.querySelector("bCs") ? true : false},
                        italic: { val: mlElement?.querySelector("rPr")?.querySelector("i") ||  mlElement?.querySelector("rPr")?.querySelector("iCs") ? true : false},
                        strike: { val: mlElement?.querySelector("rPr")?.querySelector("strike") ||  mlElement?.querySelector("rPr")?.querySelector("dstrike") ? true : false},
                        underline: { val: mlElement?.querySelector("rPr")?.querySelector("u") ? true : false},
                    },
                    t: {
                        attribute: rb?.querySelector('t')?.getAttribute('xml:space') || null,
                        text: rb?.querySelector('t')?.textContent
                    }
                }
                paragraph.r.push(r);
            }
            return paragraph
        }

        function start(path, data) {
            Documentt.fileName = path.name;
            let mlDom = pars.parseFromString(data, 'application/xml');
            let p = null;
            dragg.remove();
            let eContainer = document.createElement("div");
            eContainer.setAttribute("class", "EditorContainer");
            let e = document.createElement("div");
            e.setAttribute("class", "Editor");
            eContainer.append(e);
            vbcx.append(eContainer);

            for(const cN of mlDom.querySelector("body").childNodes){
                if(cN.localName === 'p'){
                    p = createParagraphObject(cN)
                    Documentt.body.push(p);
                    PAndR(p, e);
                } else if(cN.localName === 'tbl'){
                    t = createTableObject(cN);
                    Documentt.body.push(t);
                    createTable(e, t);
                }
            }
            
            window.mFile.fileSystem.writeFile(`${Documentt.fileName}.json`, JSON.stringify(Documentt), (err)=>{
                if (err) console.log(err)
            })
        }

        function generateWordFile(){
            let editorChilds = document.querySelector(".Editor").childNodes;
            let doEditingElements = [];
            let jfdkmv = [];
            for(let eChild of editorChilds){
                if(eChild.hasAttribute("do-editing")){
                    doEditingElements.push(eChild);
                }
            }
            
            // console.log(doEditingElements[0].childNodes);


            // for(vbnz of doEditingElements){
            //     let nbzj = Documentt.body.map((u, index)=>{
            //         // if(u.r.t === vbnz[index].getAttribute("oldvalue")){
            //         //     return u = vbnz[index].getAttribute(bjs);
            //         // }
            //         console.log(u[index])
            //     })
            //     // console.log(nbzj)
            // }


            // let newBodyArray = Documentt.body.map((currentValue)=>{
            //     if(currentValue.type === "Paragraph"){
            //         return currentValue
            //     }
            // })

            // console.log(newBodyArray)

            // let doc = new mFile.Document();

            // mFile.Packer.toBuffer(doc).then(buffer =>{
            //     fs.writeFileSync("test10.docx", buffer);
            // });

            // console.log(doEditing);
        }

        function ButtonGenerateWordFile(menu_bar){
            let buttonGenerate = document.createElement("button");
            buttonGenerate.style.height = "37px";
            buttonGenerate.style.color = "#fff";
            buttonGenerate.style.fontSize = "1.1em";
            buttonGenerate.style.borderRadius = "6px";
            buttonGenerate.style.backgroundColor = "var(--primary-colour)";
            buttonGenerate.textContent = "Wygeneruj Pliki";
            buttonGenerate.style.border = "none";
            buttonGenerate.style.marginTop = "20px";
            buttonGenerate.style.marginRight = "30px";
            buttonGenerate.addEventListener("click", generateWordFile);

            menu_bar.append(buttonGenerate);

        }

        function DialogStart2(main, file, state){
            let RootBox = document.createElement("div");
            RootBox.setAttribute("id", "dialogStart");
            RootBox.classList.add("dialogStart");

            let dialogHeader = document.createElement("div");
            dialogHeader.classList.add("dialogHeader");

            let close = document.createElement("div");
            close.classList.add("closeDlg");
            let closeImg = document.createElement("img");
            closeImg.src = "./img/close.svg";
            closeImg.alt = "close";

            close.addEventListener("click", ()=>{RootBox.remove();})

            close.append(closeImg);
            dialogHeader.append(close);

            let dialogSelectHeader = document.createElement("div");
                dialogSelectHeader.classList.add("dialogSelectHeader");

            let dialogSelectHeaderItemSettings = document.createElement("button");
                dialogSelectHeaderItemSettings.classList.add("dialogSelectHeaderItem");
                dialogSelectHeaderItemSettings.id = "settings";
                dialogSelectHeaderItemSettings.textContent = "Ustawienia";

            let dialogSelectHeaderItemCountFile = document.createElement("button");
                dialogSelectHeaderItemCountFile.classList.add("dialogSelectHeaderItem");
                dialogSelectHeaderItemCountFile.id = "countFile";
                dialogSelectHeaderItemCountFile.textContent = "Ile plików";

                if(state === "Ustawienia"){
                    dialogSelectHeaderItemSettings.setAttribute("activee", "");
                }
                
                if(state === "Ile plików"){
                    dialogSelectHeaderItemCountFile.setAttribute("activee", "");
                }

                dialogSelectHeader.append(dialogSelectHeaderItemSettings, dialogSelectHeaderItemCountFile);

                let dialogBody = document.createElement("div");
                dialogBody.classList.add("dialogBody");
                dialogBody.setAttribute("id", "dBody");

                let bv = document.createElement("div");
                bv.classList.add("bv");
                let span = document.createElement("span");
                span.textContent = "Nazwa Pliku";
                let nameFile = document.createElement("input");
                nameFile.setAttribute("type", "text");
                nameFile.setAttribute("id", "nameFile");
                nameFile.classList.add("filePath");
                nameFile.value = file.name;
                bv.append(span, nameFile);

                let bc = document.createElement("div");
                bc.classList.add("bv");
                let spann = document.createElement("span");
                spann.textContent = "Ilość Plików";
                let countC = document.createElement("div");
                countC.classList.add("countC");
                let countCPre = document.createElement("pre");
                countCPre.setAttribute("contenteditable", "true");
                countCPre.textContent = "0";
                let p = document.createElement("p");
                p.textContent = "/500";
                countC.append(countCPre, p);
                bc.append(spann, countC);

                // countCPre.type="text";
                // countCPre.inputMode = "numeric";
                // countCPre.setAttribute("pattern", "/[0-9]/g"); //, "^[0-9]+$"
                
                let nextButton = document.createElement("button");
                nextButton.setAttribute("id", "nextButton");
                nextButton.classList.add("nextButton");
                nextButton.textContent = "Dalej";

                nextButton.addEventListener("click", ()=>{
                    mFile.fileSystem.readFile(`docxs/${file.name}/word/document.xml`, 'utf8', (err, buff) => {
                        if (err) { console.log(err)}
                        inst = Number(countCPre.textContent);
                        RootBox.remove();
                        ButtonGenerateWordFile(document.querySelector("#mBar"));
                        createWorkNavBar(vbcx);
                        start(file, buff);
                    });
                });

                dialogBody.append(bv, bc, nextButton);

                RootBox.append(dialogHeader, dialogSelectHeader, dialogBody);

            main.append(RootBox);
        }
        
        function EdytorDialog(m, preElem, fN){
            let newStrings = [];
            let RootBox = document.createElement("div");
            RootBox.setAttribute("id", "dialogStart");
            RootBox.classList.add("dialogStart");

            let dialogHeader = document.createElement("div");
            dialogHeader.classList.add("dialogHeader");

            let close = document.createElement("div");
            close.classList.add("closeDlg");
            let closeImg = document.createElement("img");
            closeImg.src = "./img/close.svg";
            closeImg.alt = "close";

            close.addEventListener("click", ()=>{
                preElem.parentNode.removeAttribute("do-editing");
                RootBox.remove();
            });

            close.append(closeImg);
            dialogHeader.append(close);

            let dialogBodyEdytor = document.createElement("div");
            dialogBodyEdytor.classList.add("dialogBody");
            dialogBodyEdytor.classList.add("dialogEdytorBody");
            dialogBodyEdytor.setAttribute("id", "dBody");

            let dBodyLeft = document.createElement("div");
            dBodyLeft.classList.add("dBodyLeft");
            let PreviewTextContainer = document.createElement("div");
            PreviewTextContainer.classList.add("PreviewTextContainer");
            PreviewTextContainer.setAttribute("id", "PreviewText");
            PreviewTextContainer.style.color = preElem.getAttribute("do-color");
            PreviewTextContainer.style.textDecoration = preElem.getAttribute("do-text-decoration");
            PreviewTextContainer.style.fontStyle = preElem.getAttribute("do-font-style");
            PreviewTextContainer.style.fontWeight = preElem.getAttribute("do-font-weight");
            PreviewTextContainer.style.fontSize = `${preElem.getAttribute("do-font-size")}pt`;
            let ApplyChangeText = document.createElement("input");
            ApplyChangeText.placeholder = "Wprowadź nowe wartości";
            ApplyChangeText.classList.add("ApplyChangeText");
            ApplyChangeText.addEventListener("keydown", (e)=>{
                if(e.key === "Enter"){
                    newStrings.push(ApplyChangeText.value);
                    ApplyChangeText.value = "";
                    let rPreviewText = document.getElementById("PreviewText");
                    let rPreviewParagraph = rPreviewText.querySelectorAll("div");
                    if(rPreviewParagraph.length > 0){
                        for(let paraf of rPreviewParagraph){
                            paraf.remove();
                        }
                    }
                    for(let indexx in newStrings){
                        let p = document.createElement("div");
                        p.style.marginTop = "20px";
                        p.textContent = newStrings[indexx];
                        rPreviewText.append(p);
                    }
                }
            })

            dBodyLeft.append(PreviewTextContainer, ApplyChangeText);

            let dBodyRight = document.createElement("div");
            dBodyRight.classList.add("dBodyRight");
            let OtherFilesContainer = document.createElement("div");
            OtherFilesContainer.classList.add("OtherFilesContainer");
            for(let hd = 0; hd < inst; hd++){
                let OtherFilesItem = document.createElement("div");
                OtherFilesItem.classList.add("OtherFilesItem");
                let ffmnmn = fN.split(".") ;
                ffmnmn[0] += hd+1;
                OtherFilesItem.textContent = `${ffmnmn[0].concat(".", ffmnmn[1])}`;
                OtherFilesItem.addEventListener("click", (e)=>{
                    e.target.hasAttribute("do-select") ? e.target.removeAttribute("do-select") : e.target.setAttribute("do-select", "")
                });
                OtherFilesContainer.append(OtherFilesItem);
            }

            let continueButton = document.createElement("button");
            continueButton.classList.add("continueButton");
            continueButton.textContent = "Zatwierdź";

            continueButton.addEventListener("click", ()=>{
                let smo = document.querySelectorAll(".dBodyLeft .PreviewTextContainer div");
                let smd = document.querySelectorAll(".dBodyRight .OtherFilesContainer .OtherFilesItem[do-select]");
                if(smo.length > smd.length || smo.length < smd.length){
                    console.log("Za mało lub za dużo");
                }

                for(sm in smo){
                    if(smd[sm]?.textContent === undefined){}
                    else{
                        bjs = smd[sm].textContent.replace(".", "-");
                        preElem.setAttribute(bjs, smo[sm].textContent);
                        preElem.style.border = "2px solid #ccc50f";
                        changeFiles[bjs] = {
                            oldValue: preElem.getAttribute("oldvalue"),
                            newValue: smo[sm].textContent,
                            doColor: preElem.getAttribute("do-color")
                        }
                        console.log(changeFiles);
                    }
                }
                RootBox.remove();
            })

            dBodyRight.append(OtherFilesContainer, continueButton);
            dialogBodyEdytor.append(dBodyLeft, dBodyRight);

            RootBox.append(dialogHeader, dialogBodyEdytor);
            m.append(RootBox);
        }

        dragg.addEventListener('dd', (e)=>{
            for(const files of e.detail.f){
                if(mFile.fileSystem.existsSync(`docxs/${files.name}`)){
                    DialogStart2(vbcx, files, "Ile plików");
                }
            }
        })
    </script>
</body>
</html>